var fonts_db = ["1942 report","28 Days Later","36 days ago BRK","36 days ago Thick BRK","A bite","A.Lewis","aa�a�ae�a? ProN W6","AajaxSurrealFreak","Aarcover Regular","Aardvark Cafe","AardvarkBold","Abadi MT Condensed Extra Bold","Abadi MT Condensed Light","Abduction2002","Aberration","Abscissa","Abscissa Bold","Abscissa Bold Italic","Abscissa Italic","Abstrakt","academy engraved let","AcadEref","Acadianac","Action Jackson","AddJazz","AdineKirnberg Regular","Adler","Adobe Arabic","Adobe Arabic Bold","Adobe Arabic Bold Italic","Adobe Arabic Italic","Adobe Caslon Pro","Adobe Caslon Pro Bold","Adobe Caslon Pro Bold Italic","Adobe Caslon Pro Italic","Adobe Caslon Pro SmBd","Adobe Caslon Pro SmBd Italic","Adobe Fan Heiti Std","Adobe Fan Heiti Std B","Adobe Fangsong Std","Adobe Fangsong Std R","Adobe Garamond Pro","Adobe Garamond Pro Bold","Adobe Garamond Pro Bold Italic","Adobe Garamond Pro Italic","Adobe Gothic Std","Adobe Gothic Std B","Adobe Hebrew","Adobe Hebrew Bold","Adobe Hebrew Bold Italic","Adobe Hebrew Italic","Adobe Heiti Std","Adobe Heiti Std R","Adobe Kaiti Std","Adobe Kaiti Std R","Adobe Ming Std","Adobe Ming Std L","Adobe Myungjo Std","Adobe Myungjo Std M","Adobe Song Std","Adobe Song Std L","Aerovias Brasil NF","African","Aftermath","Aftershock Debris","Aftershock Debris Condensed","Aftershock Debris Condensed Italic","Aftershock Debris CondSolid","Aftershock Debris CondSolid Italic","Aftershock Debris Italic","Aftershock Debris Solid","Aftershock Debris Solid Italic","Agency FB","Agency FB Bold","Aharoni","Ahnberg","AIGDT","Air Conditioner","AirCut Light","Airstream NF","akaDora","Al Bayan","Al Bayan Bold","Al Bayan Plain","Albertus Extra Bold","Albertus Medium","Alfredo's Dance","algerian","Alison Regular","All Caps","Allegro","Alligator Puree","Almonte Snow","Alpha CLOWN","ALS Script","Altenburgac","amaze","Amazone BT","Ambages","AmdtSymbols","American Typewriter","American Typewriter Condensed","American Typewriter Condensed Light","American Typewriter Light","Amerika","Amerika Alternates","Amerika Sans","AmerType Md BT","Amethyst Zucchini","AMGDT","Analgesics","Andale Mono","Andalus","Angelica","Angioma AOE","Angleterre Book - DGL","Angostura","Angsana New","AngsanaUPC","Angstrom","Ann Regular","AntFarm GoneCamping","Antique Olive","Aparajita","Apple Braille","Apple Casual","Apple Chancery","Apple LiGothic","Apple LiGothic Medium","Apple LiSung","Apple LiSung Light","Apple Symbols","AppleGothic","AppleMyungjo","Aquaduct Italic","Aquaduct Plain","Aquaduct Reverse Italic","Aquaduct Warp","AR BERKLEY","AR BLANCA","AR BONNIE","AR CARTER","AR CENA","AR CHRISTY","AR DARLING","AR DECODE","AR DELANEY","AR DESTINE","AR ESSENCE","AR HERMANN","AR JULIAN","Arabic Transparent","Arabic Typesetting","Aramis Italic","Architext Regular","Arctic","Argos MF","Arial","Arial Baltic","Arial Black","Arial Bold","Arial Bold Italic","Arial CE","Arial CYR","Arial Greek","Arial Hebrew","Arial Hebrew Bold","Arial Italic","Arial MT","Arial Narrow","Arial Narrow Bold","Arial Narrow Bold Italic","Arial Narrow Italic","Arial Rounded MT Bold","Arial TUR","Arial Unicode MS","Arno Pro","Arno Pro Bold","Arno Pro Bold Caption","Arno Pro Bold Display","Arno Pro Bold Italic","Arno Pro Bold Italic Caption","Arno Pro Bold Italic Display","Arno Pro Bold Italic SmText","Arno Pro Bold Italic Subhead","Arno Pro Bold SmText","Arno Pro Bold Subhead","Arno Pro Caption","Arno Pro Display","Arno Pro Italic","Arno Pro Italic Caption","Arno Pro Italic Display","Arno Pro Italic SmText","Arno Pro Italic Subhead","Arno Pro Light Display","Arno Pro Light Italic Display","Arno Pro Smbd","Arno Pro Smbd Caption","Arno Pro Smbd Display","Arno Pro Smbd Italic","Arno Pro Smbd Italic Caption","Arno Pro Smbd Italic Display","Arno Pro Smbd Italic SmText","Arno Pro Smbd Italic Subhead","Arno Pro Smbd SmText","Arno Pro Smbd Subhead","Arno Pro SmText","Arno Pro Subhead","Arrobatherapy","Arrus BT","Asenine","Asenine Super Thin","Asenine Thin","Asenine Wide","AT*Fujiyama","AT*Fujiyama Black","AT*Fujiyama Extra Bold","AT*Fujiyama Light","AT*Fujiyama2","Atlas","Aurora Cn BT","AvantGarde Bk BT","AvantGarde Md BT","AvenirBlk_PFL","AvenirLt_PFL","AvenirMd_PFL","Ayuthaya","Baghdad","balthazar","Bank Gothic","bankgothic lt bt","BankGothic Md BT","bart","Baskerville","Baskerville Old Face","Baskerville Semibold","Batang","BatangChe","Bauhaus 93","Bazooka","Bell Gothic Std Black","Bell Gothic Std Bold","Bell Gothic Std Light","Bell MT","Benguiat Bk BT","Berlin Sans FB","Berlin Sans FB Demi","Bernard MT Condensed","BernhardFashion BT","BernhardMod BT","BiauKai","Bickham Script Pro Bold","Bickham Script Pro Regular","Bickham Script Pro Semibold","Big Caslon","bimini","BinnerD","Birch Std","Bitstream Charter","Bitstream Vera Sans","Bitstream Vera Sans Mono","Bitstream Vera Serif","Blackadder ITC","Blackletter686 BT","Blackmoor LET","Blackoak Std","BlairMdITC TT","BlairMdITC TT-Medium","Blockbuster","Bodoni MT","Bodoni MT Black","Bodoni MT Condensed","Bodoni MT Poste...d","Myriad Pro Cond It","Myriad Pro It","Myriad Pro Light","Myriad Pro Light Cond","Myriad Pro Semibold","Myriad Pro Semibold It","Myriad Web Pro","Myriad Web Pro Condensed","Nadeem","Narkisim","New Peninim MT","New Peninim MT Bold","New Peninim MT Bold Inclined","New Peninim MT Inclined","new york","News Gothic MT","News GothicMT","NewsGoth BT","Niagara Engraved","Niagara Solid","Nimbus Mono L","Nimbus Roman No 9 L","Nimbus Sans L","Nina","Nonfiction","NSimSun","Nueva Std","Nueva Std Bold Cond","Nueva Std Bold Cond Italic","Nueva Std Cond","Nueva Std Cond Italic","Nyala","OCR A Extended","OCR A Std","Odessa LET","Old Century","Old English Text MT","olddreadfulno7 bt","One Stroke Script LET","Onyx","Onyx BT","OpenSymbol","Optima","Optima ExtraBlack","orange let","Orator Std","Orator Std Slanted","Osaka","Osakaac�a1","OzHandicraft BT","Palace Script MT","palatino","palatino linotype","PanRoman","Papyrus","Papyrus Condensed","Parchment","ParkAvenue BT","Party LET","PCMyungjo","Pegasus","Perpetua","Perpetua Bold","Perpetua Bold Italic","Perpetua Italic","Perpetua Titling MT","Pickwick","PilGi","Plantagenet Cherokee","playbill","PMingLiU","PMingLiU-ExtB","Poor Richard","Poplar Std","PortagoITC TT","Poster","PosterBodoni BT","Prestige Elite Std","Prestige Elite Std Bold","Princetown LET","Pristina","Proxy 1","Proxy 2","Proxy 3","Proxy 4","Proxy 5","Proxy 6","Proxy 7","Proxy 8","Proxy 9","PTBarnum BT","pump demi bold let","puppylike","Pythagoras","Quixley LET","Raanana","Raavi","Rage Italic","Rage Italic LET","Ravie","Ribbon131 Bd BT","Rockwell","Rockwell Condensed","Rockwell Extra Bold","Rod","roland","RomanC","RomanD","RomanS","RomanT","Romantic","Rosewood Std","Rosewood Std Regular","Ruach LET","Saab","Sakkal Majalla","sans-serif","SansSerif","Santa Fe LET","Sathu","Savoye LET","Sceptre","SchoolHouse Cursive B","SchoolHouse Printed A","Script MT Bold","ScriptC","scripts","scruff let","Segoe Condensed","Segoe Print","Segoe Script","Segoe UI","Segoe UI Light","Segoe UI Semibold","Segoe UI Symbol","serif","Serifa BT","Serifa Th BT","ShelleyVolante BT","Sherwood","Shonar Bangla","short hand","Showcard Gothic","Shruti","Signboard","signs normal","Silom","SimHei","simplex","Simplified Arabic","Simplified Arabic Fixed","simpson","SimSun","SimSun-ExtB","Skia","Smudger LET","Snap ITC","Snell Roundhand","Snell Roundhand Black","Snell Roundhand Bold","Socket","Souvenir Lt BT","Space Age","Square721 BT","Staccato222 BT","Steamer","Stencil","Stencil Std","STFangsong","STHeiti","STKaiti","Stone Sans ITC TT","Stone Sans ITC TT-Bold","Stone Sans ITC TT-Semi","Stone Sans ITC TT-SemiIta","Stone Sans OS ITC TT-Bold","Stone Sans OS ITC TT-Semi","Stone Sans OS ITCTT-SemiIta","Stone Sans Sem ITC TT","Storybook","STSong","stylus bt","Subway","superfrench","surfer","SWGamekeys MT","Swis721 BdCnOul BT","Swis721 BdOul BT","Swis721 Blk BT","Swis721 BlkCn BT","Swis721 BlkEx BT","swis721 blkoul bt","swis721 bt","Swis721 Cn BT","Swis721 Ex BT","Swis721 Lt BT","Swis721 LtCn BT","Swis721 LtEx BT","Swiss911 XCm BT","SWMacro","Syastro","Sylfaen","symap","Symath","symbol","Symeteo","Symusic","Synchro LET","Tahoma","Tahoma Bold","technic","Technical","TechnicBold","TechnicLite","Tekton Pro","Tekton Pro Bold","Tekton Pro BoldCond","Tekton Pro BoldExt","Tekton Pro BoldObl","Tekton Pro Cond","Tekton Pro Ext","Teletype","Tempus Sans ITC","terk","Terminal","TeX","Thonburi","Thonburi Bold","TimeA1","Times","Times CE","Times CY","Times New Roman","Times New Roman Baltic","Times New Roman Bold","Times New Roman Bold Italic","Times New Roman CE","Times New Roman CYR","Times New Roman Greek","Times New Roman Italic","Times New Roman PS","Times New Roman TUR","TimesTen","Tiranti Solid LET","Traditional Arabic","Trajan Pro","Trajan Pro Bold","Trebuchet MS","Trebuchet MS Bold","Trebuchet MS Bold Italic","Trebuchet MS Italic","Trebuchet_PFL","trendy","Tristan","Tubular","Tunga","Tw Cen MT","Tw Cen MT Bold","Tw Cen MT Bold Italic","Tw Cen MT Condensed","Tw Cen MT Condensed Extra Bold","Tw Cen MT Italic","txt","Type Embellishments One LET","TypoUpright BT","Ubuntu","Unicorn","Univers","Univers Condensed","UniversalMath1 BT","University Roman LET","URW Antiqua T","URW Gothic L","URW Grotesk T","URW Palladio L","Utopia","Utsaah","Vagabond","Vani","Verdana","Verdana Bold","Verdana Bold Italic","Verdana Italic","Verona","victorian let","Vijaya","Viner Hand ITC","vineta bt","Vivaldi","vivian","Vladimir Script","Vrinda","VTC Tribal Regular","Warnock Pro","Warnock Pro Caption","Warnock Pro Display","Warnock Pro Light","Warnock Pro Light Caption","Warnock Pro Light Display","Warnock Pro Light Subhead","Warnock Pro SmBd","Warnock Pro SmBd Caption","Warnock Pro SmBd Display","Warnock Pro SmBd Subhead","Warnock Pro Subhead","webdings","western","Westminster","westwood let","wide latin","wingdings","Wingdings 2","Wingdings 3","Xerox Malfunction BRK","Zapf Dingbats","ZapfEllipt BT","ZapfHumnst BT","ZapfHumnst Dm BT","Zapfino","Zurich BlkEx BT","Zurich Ex BT","ZWAdobeF"];

function fontList(fonts) {}
function set_new_uid(uid)
{
    ec.set('uid', uid)
}

function start_test()
{
    var fp = 
    {
        locality : "", os : "", screen : "", timezone : "", fonts_all : "", fontlist : "", plugins_univ : "", 
        plugins_nonu : "", plugins_all : "", mimetypes : "", navigator_hash : "", screen_avail : "", build_id : "", 
        dnt : "", uid : "", fire_gloves : ""
    };
    try
    {
        fp.locality = window.navigator.userLanguage || window.navigator.language;
        if (navigator.appVersion.indexOf("Win") !=- 1) {
            fp.os = "Windows";
        }
        if (navigator.appVersion.indexOf("Mac") !=- 1) {
            fp.os = "MacOS";
        }
        if (navigator.appVersion.indexOf("X11") !=- 1) {
            fp.os = "UNIX";
        }
        if (navigator.appVersion.indexOf("Linux") !=- 1) {
            fp.os = "Linux";
        }
        fp.screen = screen.width + "x" + screen.height;
        fp.screen_avail = screen.availWidth + "x" + screen.availHeight;
        fp.timezone = new Date().getTimezoneOffset();
        fp.build_id = navigator.buildID ? navigator.buildID : "undefined";
        fp.dnt = navigator.doNotTrack ? navigator.doNotTrack : "undefined";
        fp.fire_gloves = ((typeof (ntrn) == "function" && typeof (ntra) == "function") || (typeof (FireGlovesStats) == "object")) ? 'on' : 'off'
    }
    catch (e) {}
    var det = new Detector();
    for (i = 0; i < fonts_db.length; i++) {
        fonts_db.push(det.detailedTest(fonts_db.shift()));
    }
    for (i = 0; i < fonts_db.length; i++) {
        fp.fonts_all += fonts_db[i][3] ? '1' : '0';
    }
    fp.fontlist = getFullFontList();
    try
    {
        fp.plugins_univ = detectPlugins();
        fp.plugins_nonu = detectPluginsNonUniv();
        fp.plugins_all = detectPluginsAll();
        fp.mimetypes = getMimeTypes();
        fp.navigator_hash = hex_sha1(serialize(navigator))
    }
    catch (e) {}
    if (typeof ec == 'undefined') {
        ec = new evercookie();
    }
    function getcookie()
    {
        ec.get('uid', function (value, all)
        {
            if (value != undefined) {
                fp.uid = value;
            }
            else
            {
                fp.uid = '';
            }
            postResults(fp);
        }, 1)
    }
    getcookie()
}
function postResults(fp)
{
	$.ajax({
	  type: "POST",
	  contentType: "application/json; charset=utf-8",
	  url: flask_util.url_for('fingerprint.set_fingerprint'),
	  action: 'ajax',
	  senddata: 1,
	  data: $.toJSON(fp),
	  success: function (data)
      {
        js_fp_callback(data);
	  },
	  dataType: "json"
	});
	
}
function detectPlugins()
{
    var pName = ['Silverlight', 'VLC', 'Java', 'Shockwave', 'QuickTime'];
    var pAv = [];
    var pVer = [];
    var plugins = [];
    PluginDetect.getVersion('.');
    for (var i in pName)
    {
        pAv[i] = PluginDetect.isMinVersion(pName[i], '0') >= 0;
        pVer[i] = PluginDetect.getVersion(pName[i])
    }
    for (var i in pName) {
        plugins[i] = pName[i] + ": " + (pAv[i] ? pVer[i] : 'none');
    }
    return plugins.join(', ')
}
function detectPluginsNonUniv()
{
    var pName = ['Flash', 'AdobeReader', ];
    var pAv = [];
    var pVer = [];
    var plugins = [];
    PluginDetect.getVersion('.');
    for (var i in pName)
    {
        pAv[i] = PluginDetect.isMinVersion(pName[i], '0') >= 0;
        pVer[i] = PluginDetect.getVersion(pName[i])
    }
    var ari = pName.indexOf('AdobeReader');
    if (pVer[ari] != null) {
        pVer[ari] = pVer[ari].match(/\d+\.\d+/);
    }
    var fli = pName.indexOf('Flash');
    if (pVer[fli] != null) {
        pVer[fli] = pVer[fli].match(/\d+\.\d+\.\d+/);
    }
    for (var i in pName) {
        plugins[i] = pName[i] + ": " + (pAv[i] ? pVer[i] : 'none');
    }
    return plugins.join(', ')
}
function detectPluginsAll()
{
    var pName = ['Silverlight', 'VLC', 'Java', 'Shockwave', 'QuickTime', 'Flash', 'AdobeReader', 'WindowsMediaPlayer'];
    var pAv = [];
    var pVer = [];
    var plugins = [];
    var ji = null;
    PluginDetect.getVersion('.');
    for (var i in pName)
    {
        pAv[i] = PluginDetect.isMinVersion(pName[i], '0') >= 0;
        pVer[i] = PluginDetect.getVersion(pName[i])
    }
    ji = PluginDetect.getInfo('Java', flask_util.url_for('static', {filename:'javascript/plugindetect/getJavaInfo.jar'}));
    var jitext = typeof ji == "object" ? (ji.DeployTK_versions.toString() + "-" + ji.description + "-" + ji.isPlugin2 + "-" + ji.name + "-" + ji.vendor) : null;
    for (var i in pName) {
        plugins[i] = pName[i] + ": " + (pAv[i] ? pVer[i] : 'none');
    }
    return plugins.join(', ') + ', javainfo: ' + jitext
}
function getMimeTypes()
{
    var mimes = [];
    if (navigator.mimeTypes)
    {
        for (var i in navigator.mimeTypes) 
        {
            var m = navigator.mimeTypes[i];
            var p = m.enabledPlugin;
            mimes.push(m.description + "#" + m.suffixes + "#" + m.type + "#" + (p == null ? '' : (p.filename + "#" + p.name + "#" + p.version))) 
        }
        return mimes.join('|');
    }
    else return '';
}
function getFullFontList()
{
    var fonts = "";
    var obj = document.getElementById("flashfontshelper");
    try
    {
        if (obj && typeof (obj.GetVariable) != "undefined") {
            fonts = obj.GetVariable("/:user_fonts");
            fonts = fonts.replace(/,/g, ", ");
        }
    }
    catch (e) {}
    return fonts ? fonts : ""
}
function serialize(obj, tabs, rec)
{
    if (typeof (objs) == 'undefined') {
        objs = [];
    }
    if (typeof (tabs) == 'undefined') {
        tabs = "";
    }
    if (typeof (rec) == 'undefined') {
        rec = 0;
        objs = []
    }
    if (rec > 4) {
        return "tmr";
    }
    var res = "";
    var nl = "|";
    for (var i in obj)
    {
        try
        {
            res += tabs + i + ":";
            if (typeof obj[i] == 'function')
            {
                res += 'func' + nl
            }
            else if (obj[i]instanceof Array) {
                res += "[" + nl + serialize(obj[i], tabs + "#", rec + 1) + nl + "]" + nl
            }
            else if (typeof obj[i] == 'object' && obj[i] != null)
            {
                if (objs.indexOf(obj[i]) ==- 1) {
                    objs.push(obj[i]);
                    res += "{" + nl + serialize(obj[i], tabs + "#", rec + 1) + nl + tabs + "}" + nl
                }
                else {
                    res += "ref" + nl;
                }
            }
            else {
                res += obj[i] + nl;
            }
        }
        catch (e) {
            res += tabs + "E:" + e.message + nl
        }
    }
    return res
}
$('body').append('<div id="flashcontent"></div>');
$('#flashcontent').flash(
{
    src : flask_util.url_for('static', {filename:"flash/fonts2.swf"}), width : "1", height : "1", swliveconnect : "true", id : "flashfontshelper",
    name : "flashfontshelper"
},
{
    update : false
});
setTimeout(start_test, 0); // Autostart